#
# SRG-335x Debian Buster
#
# Copyright (c) LYD/AAEON, 2020
#
# Authors:
#   KunYi <kunyi.chen@gmail.com>
#
# SPDX-License-Identifier: MIT
#

header:
  version: 8

distro: srg52-buster
target: srg52-image

repos:
  meta-srg52:

  isar:
    url: https://github.com/ilbers/isar.git
    refspec: 075646cd5f588a80b6c134e95f5b4ff781d3f057
    layers:
      meta:
    patches:
      01-libubootenv:
        path: isar-patches/0001-u-boot-add-libubootenv.patch
        repo:  meta-srg52
      02-initramfs:
        path: isar-patches/v7-0001-meta-support-Generate-a-custom-initramfs.patch
        repo:  meta-srg52

bblayers_conf_header:
  standard: |
    LCONF_VERSION = "6"
    BBPATH = "${TOPDIR}"
    BBFILES ?= ""

local_conf_header:
  standard: |
    CONF_VERSION = "1"
  cross: |
    ISAR_CROSS_COMPILE = "1"
  root_password: |
    USERS += "root"
    # 'aaeon'
    USER_root[password] = "$6$x/JYBdqHvCCs6EQM$blmDpS8NO7OkPyvy3NBmZLsOHI.7qE5V/IbpHsrhbagrbaPFsqFNYKSxGlPGNY9AZVtX8e2ZN4CmPMPpZCiYQ."
  preinstall_package: |
    IMAGE_PREINSTALL += "nano wpasupplicant network-manager modemmanager dnsmasq"
    IMAGE_PREINSTALL += "python3 python3-pip"
    IMAGE_PREINSTALL += "lshw usbutils cpufrequtils gdisk"
    IMAGE_PREINSTALL += "libiio-dev libiio-utils libiio0 python3-libiio"
    IMAGE_PREINSTALL += "firmware-linux firmware-linux-free firmware-linux-nonfree firmware-misc-nonfree"
    IMAGE_PREINSTALL += "firmware-atheros firmware-brcm80211 firmware-ralink firmware-realtek"
    IMAGE_PREINSTALL += "libmodbus-dev libmodbus5  libmosquitto-dev libmosquitto1"
    # from cip-core security
    IMAGE_PREINSTALL += "openssl libssl1.1 \
                         fail2ban \
                         openssh-server openssh-sftp-server openssh-client \
                         syslog-ng-core syslog-ng-mod-journal \
                         aide aide-common \
                         libnftables0 nftables \
                         libpam-pkcs11 \
                         chrony \
                         tpm2-tools \
                         tpm2-abrmd \
                         libtss2-esys0 libtss2-udev \
                         libpam-cracklib \
                         acl \
                         libauparse0 audispd-plugins auditd \
                         uuid-runtime \
                         sudo \
                        "
    # for avahi-daemon
    IMAGE_PREINSTALL += "avahi-daemon bind9-host libavahi-common-data \
                          libavahi-common3 libavahi-core7 libbind9-161 \
                          libdaemon0 libdns1104 libfstrm0 libgeoip1 \
                          libisc1100 libisccc161 libisccfg163   \
                          liblmdb0 liblwres161 libprotobuf-c1   \
                        "
    # for wireless tools"
    IMAGE_PREINSTALL += "libiw30 wireless-tools"
    # IMAGE_PREINSTALL += "hostapd"

  image_type: |
    IMAGE_TYPE = "wic-targz-img"
